import { supabase } from '@/integrations/supabase/client';

export interface AIInsightRequest {
  type: 'portfolio_analysis' | 'market_prediction' | 'trading_suggestion' | 'chat_question';
  data: any;
}

export interface AIInsightResponse {
  analysis: string;
  suggestions: string[];
  risk_level: 'low' | 'medium' | 'high';
  confidence: number;
}

export const getAIInsights = async (request: AIInsightRequest): Promise<AIInsightResponse> => {
  try {
    // Call Supabase Edge Function for AI analysis
    const { data, error } = await supabase.functions.invoke('ai-insights', {
      body: request
    });

    if (error) {
      console.error('AI Insights Error:', error);
      throw error;
    }

    return data;
  } catch (error) {
    console.error('Error getting AI insights:', error);
    
    // Enhanced AI response system with comprehensive market analysis
    const question = request.data?.question?.toLowerCase() || '';

    let analysis = "";
    let suggestions: string[] = [];
    let risk_level: 'low' | 'medium' | 'high' = 'medium';

    // Bitcoin Analysis - Enhanced
    if (question.includes('bitcoin') || question.includes('btc')) {
      analysis = `üìä PH√ÇN T√çCH TO√ÄN DI·ªÜN BITCOIN (BTC):

üî• Current Status:
Bitcoin ƒëang consolidation trong v√πng $42,000-$48,000 v·ªõi c√°c t√≠n hi·ªáu technical v√† fundamental h·ªón h·ª£p.

üìà Technical Analysis:
‚Ä¢ Price Action: Sideway v·ªõi bias tƒÉng nh·∫π
‚Ä¢ Support levels: $42,000 (strong) | $39,000 (critical)
‚Ä¢ Resistance: $48,000 (immediate) | $52,000 (major)
‚Ä¢ RSI (14): 55-60 (neutral zone)
‚Ä¢ MACD: Flatten, ch·ªù signal m·ªõi
‚Ä¢ Volume: Below average, ch∆∞a c√≥ breakout confirmation

üåç On-Chain Metrics:
‚Ä¢ Hash Rate: All-time high (network security tƒÉng)
‚Ä¢ Active Addresses: 900K+ daily (healthy network)
‚Ä¢ Exchange Inflows: Gi·∫£m (bullish signal)
‚Ä¢ Long-term Holders: 70% supply held >1 year
‚Ä¢ Whale Activity: Accumulation pattern

üèõÔ∏è Fundamental Drivers:
‚Ä¢ Bitcoin Halving 2024 (Q2): Historically bullish 12-18 months sau
‚Ä¢ ETF Approvals: BlackRock IBIT v√† c√°c ETF kh√°c t·∫°o institutional demand
‚Ä¢ Macro Environment: Fed pause policy supportive cho risk assets
‚Ä¢ Corporate Adoption: MicroStrategy, Tesla maintain positions
‚Ä¢ Lightning Network: Payment adoption tƒÉng

üéØ Price Scenarios:
Bullish (60%): $55,000-$65,000 by Q4 2024
Base (30%): $45,000-$55,000 sideways
Bearish (10%): $35,000-$42,000 if macro deteriorates`;

      suggestions = [
        "üí° DCA Strategy: Mua $100-500 weekly thay v√¨ lump sum ƒë·ªÉ average cost",
        "üìä Technical Setup: Wait for breakout above $48,000 v·ªõi volume confirmation",
        "‚ö†Ô∏è Risk Management: Stop-loss ·ªü $40,000 (7-8% risk from current)",
        "üéØ Take Profit Levels: 25% at $52K, 25% at $58K, 50% ride the trend",
        "‚è∞ Timing: Fed meetings v√† CPI data l√†m catalysts quan tr·ªçng",
        "üîÑ Portfolio: 40-50% of crypto allocation reasonable cho BTC",
        "üì± Tools: Use Dollar Cost Average apps, set price alerts",
        "üß† Psychology: Ignore daily noise, focus weekly/monthly charts"
      ];
      risk_level = 'medium';

    // Ethereum Analysis - Enhanced
    } else if (question.includes('ethereum') || question.includes('eth')) {
      analysis = `üìä PH√ÇN T√çCH CHUY√äN S√ÇUB ETHEREUM (ETH):

üöÄ Current Momentum:
Ethereum ƒëang outperform Bitcoin v·ªõi ecosystem ph√°t tri·ªÉn m·∫°nh m·∫Ω.

üìà Technical Analysis:
‚Ä¢ Price: Consolidation $2,800-$3,200
‚Ä¢ Support: $2,800 (tested multiple times)
‚Ä¢ Resistance: $3,400 (major), $3,800 (ATH approach)
‚Ä¢ ETH/BTC Ratio: 0.072 (healthy vs BTC)
‚Ä¢ Gas Fees: Stable 15-25 gwei (L2 working)

üèóÔ∏è Ecosystem Development:
‚Ä¢ Shanghai Upgrade: Staking withdrawals enabled th√†nh c√¥ng
‚Ä¢ Layer 2 Boom: Arbitrum, Optimism, Polygon TVL tƒÉng 300%
‚Ä¢ EIP-4844 (Dencun): Reduced L2 costs by 90%
‚Ä¢ Validator Count: 1M+ validators (decentralization tƒÉng)
‚Ä¢ Staking Ratio: 22% total supply (vs competitors ~60%)

üí∞ DeFi & Utility:
‚Ä¢ Total Value Locked: $25B+ (dominant position)
‚Ä¢ Daily Transactions: 1.2M (vs BSC 3M, but higher value)
‚Ä¢ NFT Market: Still #1 platform for premium collections
‚Ä¢ Institutional Staking: Coinbase, Lido, RocketPool

üéØ Catalysts Ahead:
‚Ä¢ Ethereum ETF: Following BTC ETF success
‚Ä¢ Proto-Danksharding: Major scalability upgrade
‚Ä¢ Real-World Assets: BlackRock tokenization on Ethereum
‚Ä¢ Gaming Integration: AAA games building on ETH L2s

üìä Valuation Metrics:
‚Ä¢ P/E Ratio: 25x (vs historical 30-50x trong bull)
‚Ä¢ Revenue: $2.5B annually from fees
‚Ä¢ Burn Rate: 2.7 ETH/min average (deflationary)
‚Ä¢ Market Cap: $350B (room to grow vs $500B peak)`;

      suggestions = [
        "üéØ Entry Strategy: $2,900-$3,000 l√† good accumulation zone",
        "üí∞ Staking Option: 4.2% APR through Lido ho·∫∑c RocketPool",
        "üîÑ ETH/BTC Pair: Target ratio 0.08-0.085 (vs current 0.072)",
        "üåç Layer 2 Exposure: Hold some ARB, OP tokens cho ecosystem play",
        "‚õΩ Gas Tracker: Low gas = good entry timing",
        "üìà Target Prices: $3,600 (Q2), $4,500 (Q4) if market cooperation",
        "üîí Long-term Hold: ETH has stronger fundamentals than most alts",
        "‚ö†Ô∏è Risk: Regulatory uncertainty around staking in US"
      ];
      risk_level = 'low';

    // Risk Management - Comprehensive Guide
    } else if (question.includes('r·ªßi ro') || question.includes('qu·∫£n l√Ω') || question.includes('risk') || question.includes('stop loss')) {
      analysis = `‚ö†Ô∏è QU·∫¢N L√ù R·ª¶I RO CRYPTO - COMPLETE GUIDE:

üéØ Core Principles:
Crypto c√≥ volatility 3-5x stock market. Risk management kh√¥ng ch·ªâ b·∫£o v·ªá m√† c√≤n optimize returns.

üí∞ Position Sizing Framework:
‚Ä¢ 1% Rule: Max risk 1% t√†i kho·∫£n per trade
‚Ä¢ 2% Rule: Aggressive traders c√≥ th·ªÉ 2%
‚Ä¢ Portfolio Heat: T·ªïng risk kh√¥ng qu√° 6-8%
‚Ä¢ V√≠ d·ª•: $50K account ‚Üí Max $500 risk/trade

üìä Portfolio Allocation Models:

üèõÔ∏è Conservative (60/30/10):
‚Ä¢ 60% BTC+ETH (Core positions)
‚Ä¢ 30% Top 10 alts (Quality growth)
‚Ä¢ 10% Moonshots (High risk/reward)

‚ö° Aggressive (40/40/20):
‚Ä¢ 40% BTC+ETH
‚Ä¢ 40% Top 20 alts
‚Ä¢ 20% Small caps + new projects

üõ°Ô∏è Risk Management Tools:

1Ô∏è‚É£ Stop Losses:
‚Ä¢ Technical: Below support levels
‚Ä¢ Percentage: 8-12% for crypto (vs 2-4% stocks)
‚Ä¢ Trailing: Let winners run, cut losers quick
‚Ä¢ Time-based: Exit if thesis invalidated

2Ô∏è‚É£ Position Sizing:
‚Ä¢ Kelly Criterion: Optimal % = (Win Rate √ó Avg Win - Avg Loss) / Avg Win
‚Ä¢ Simple: Risk wanted / (Entry - Stop) = Position size
‚Ä¢ Never risk more than you sleep comfortably

3Ô∏è‚É£ Diversification:
‚Ä¢ Time: DCA over months, not lump sum
‚Ä¢ Assets: Different sectors (L1, DeFi, Gaming, AI)
‚Ä¢ Strategies: Spot + DeFi yield + staking
‚Ä¢ Geography: Avoid single country regulations

üìà Advanced Strategies:

üîÑ Rebalancing:
‚Ä¢ Monthly: Trim winners, add to losers
‚Ä¢ Threshold: Rebalance when 5% deviation
‚Ä¢ Tax: Consider implications when rebalancing

‚è∞ Market Cycle Management:
‚Ä¢ Bear Market: Accumulate, 80% cash is OK
‚Ä¢ Bull Market: Take profits incrementally
‚Ä¢ Cycle Top: Have exit plan, don't be greedy
‚Ä¢ Cycle Bottom: Leverage when others capitulate

üß† Psychological Framework:
‚Ä¢ FOMO: Most expensive emotion in crypto
‚Ä¢ FUD: Often buying opportunities
‚Ä¢ Confirmation Bias: Seek opposing views
‚Ä¢ Patience: Time in market > timing market`;

      suggestions = [
        "üì± Tools: Use position size calculators (tradingview has good ones)",
        "üìä Tracking: Portfolio tracker (CoinTracker, Koinly) for tax + analysis",
        "‚ö†Ô∏è Stop Loss: Set BEFORE entering trade, stick to plan",
        "üíé DCA Strategy: Weekly buys reduce timing risk significantly",
        "üéØ Take Profits: 25% at 2x, 25% at 5x, 50% for moonshot",
        "üìù Trading Journal: Record reasoning, emotions, learnings",
        "üîê Security: Hardware wallet for 80%+ holdings",
        "üìö Education: Risk 1% on learning > 10% on speculation",
        "üßò Mental Health: Don't check prices 24/7, set weekly reviews",
        "üë• Community: Join level-headed groups, avoid FOMO chambers"
      ];
      risk_level = 'high';

    // Trading Psychology
    } else if (question.includes('t√¢m l√Ω') || question.includes('psychology') || question.includes('c·∫£m x√∫c') || question.includes('emotion')) {
      analysis = `üß† TRADING PSYCHOLOGY - THE ULTIMATE GUIDE:

‚ö†Ô∏è The Statistics:
‚Ä¢ 90% traders lose money first year
‚Ä¢ 80% quit within 2 years  
‚Ä¢ 95% never achieve consistent profitability
‚Ä¢ Psychology = 80% of trading success

üò± Common Emotional Traps:

1Ô∏è‚É£ FOMO (Fear of Missing Out):
‚Ä¢ Symptoms: Chasing pumps, buying tops
‚Ä¢ Trigger: Social media, friend's gains
‚Ä¢ Solution: Have predetermined entry plan

2Ô∏è‚É£ FUD (Fear, Uncertainty, Doubt):
‚Ä¢ Symptoms: Panic selling bottoms
‚Ä¢ Trigger: News, market crashes
‚Ä¢ Solution: Understand market cycles

3Ô∏è‚É£ Revenge Trading:
‚Ä¢ Symptoms: Increasing position after loss
‚Ä¢ Trigger: Ego, need to "get even"
‚Ä¢ Solution: Walk away, review later

4Ô∏è‚É£ Confirmation Bias:
‚Ä¢ Symptoms: Only reading bullish news for holdings
‚Ä¢ Trigger: Protecting beliefs
‚Ä¢ Solution: Seek opposing viewpoints

üí™ Building Mental Strength:

üéØ Mindset Shifts:
‚Ä¢ Probabilistic Thinking: Each trade = business decision
‚Ä¢ Process Focus: Control process, not outcomes
‚Ä¢ Long-term View: Compound gains over quick wins
‚Ä¢ Risk First: Protect capital before growing it

üìù Practical Techniques:

‚úÖ Pre-Trade Checklist:
‚Ä¢ Why entering? (Technical + fundamental reason)
‚Ä¢ What's the risk? ($ amount, not just %)
‚Ä¢ Exit plan? (Stop loss + take profit)
‚Ä¢ Position size? (Based on risk tolerance)
‚Ä¢ Emotions check? (Calm, logical state?)

üìä Post-Trade Review:
‚Ä¢ Did I follow my plan?
‚Ä¢ What emotions did I feel?
‚Ä¢ What would I do differently?
‚Ä¢ What did I learn?

üßò Stress Management:
‚Ä¢ Meditation: 10 min daily reduces emotional trading
‚Ä¢ Exercise: Physical health = mental clarity
‚Ä¢ Sleep: 7+ hours essential for good decisions
‚Ä¢ Breaks: Step away from charts regularly

üéÆ The Winner's Framework:

üìà Expectations:
‚Ä¢ Losing streaks normal (even 60% win rate has 5+ consecutive losses)
‚Ä¢ Drawdowns temporary (plan for 20-30% portfolio drops)
‚Ä¢ Time horizon: Think years, not days
‚Ä¢ Learning curve: 2-3 years to become competent

üèÜ Success Habits:
‚Ä¢ Trade size: Reduce when emotional
‚Ä¢ Journaling: Track all trades + emotions
‚Ä¢ Rules: Write down, follow consistently  
‚Ä¢ Community: Surround with winners, not gamblers`;

      suggestions = [
        "üìö Education: Read 'Trading in the Zone' by Mark Douglas",
        "üßò Meditation: Headspace app, 10 min daily before market open",
        "üìù Journal: TradingView journal or simple Excel spreadsheet",
        "üí™ Exercise: 30 min daily helps emotional regulation",
        "‚è∞ Routine: Consistent daily routine reduces decision fatigue",
        "üë• Mentorship: Find experienced trader who's profitable",
        "üéØ Goals: Process goals (follow plan) vs outcome goals (profit)",
        "üì± Apps: Use position size calculators to remove emotion",
        "üö´ Limits: Maximum trades per day, maximum risk per week",
        "üèÜ Rewards: Celebrate process wins, not just profit wins"
      ];
      risk_level = 'high';

    // DeFi and Yield Farming
    } else if (question.includes('defi') || question.includes('yield') || question.includes('farming') || question.includes('staking')) {
      analysis = `üåæ DeFi & YIELD FARMING - COMPLETE ECOSYSTEM:

üí∞ Current DeFi Landscape:
‚Ä¢ Total Value Locked: $45B (down from $180B peak)
‚Ä¢ Yield Opportunities: 3-50% APY depending on risk
‚Ä¢ Main Chains: Ethereum, BSC, Polygon, Arbitrum, Avalanche

üè¶ Core DeFi Strategies:

1Ô∏è‚É£ Lending/Borrowing:
‚Ä¢ Platforms: Aave, Compound, MakerDAO
‚Ä¢ Strategy: Lend stablecoins (3-8% APY)
‚Ä¢ Advanced: Borrow against collateral for leverage
‚Ä¢ Risk: Liquidation if collateral drops

2Ô∏è‚É£ Liquidity Providing:
‚Ä¢ Concept: Provide tokens to AMM pools
‚Ä¢ Returns: Trading fees + liquidity rewards
‚Ä¢ Popular: Uniswap V3, Curve, Balancer
‚Ä¢ Risk: Impermanent loss when prices diverge

3Ô∏è‚É£ Yield Farming:
‚Ä¢ Method: Stake LP tokens for additional rewards
‚Ä¢ Platforms: Convex, Yearn, Beefy
‚Ä¢ Returns: 10-50% APY (varies by pool)
‚Ä¢ Risk: Smart contract bugs, token dumps

üéØ Risk-Adjusted Strategies:

üõ°Ô∏è Conservative (5-12% APY):
‚Ä¢ USDC lending on Aave
‚Ä¢ ETH staking (Lido, RocketPool)  
‚Ä¢ Stable-stable LPs (USDC/USDT)
‚Ä¢ Blue-chip protocols only

‚ö° Moderate (15-30% APY):
‚Ä¢ ETH/USDC LP on Uniswap V3
‚Ä¢ Curve pools with CRV rewards
‚Ä¢ Yearn vaults (automated strategies)
‚Ä¢ Cross-chain yield opportunities

üöÄ Aggressive (30-100%+ APY):
‚Ä¢ New protocol launch incentives
‚Ä¢ Leveraged yield farming
‚Ä¢ Options strategies (covered calls)
‚Ä¢ Meme coin pools (extreme risk)

‚ö†Ô∏è Risk Management:

üíÄ Smart Contract Risk:
‚Ä¢ Use audited protocols (Certik, Trail of Bits)
‚Ä¢ Start small, test withdrawals
‚Ä¢ Diversify across platforms
‚Ä¢ Monitor protocol TVL and age

üîÑ Impermanent Loss:
‚Ä¢ Choose correlated pairs (ETH/wstETH)
‚Ä¢ Use IL calculators before entering
‚Ä¢ Consider single-asset staking instead
‚Ä¢ Monitor pool composition changes

üìä Technical Risks:
‚Ä¢ Slippage on large trades
‚Ä¢ MEV bots front-running
‚Ä¢ Network congestion affecting exits
‚Ä¢ Bridge risks for cross-chain

üõ†Ô∏è DeFi Tools:

üì± Essential Apps:
‚Ä¢ DeBank: Portfolio tracking
‚Ä¢ Zapper: Multi-protocol interface
‚Ä¢ 1inch: DEX aggregator
‚Ä¢ Yearn: Automated strategies

üìä Analytics:
‚Ä¢ DeFiPulse: Protocol rankings
‚Ä¢ DeFiLlama: TVL and yields
‚Ä¢ APY.vision: LP performance
‚Ä¢ CoinGecko: Yield comparisons

üí° Tax Considerations:
‚Ä¢ Yield = taxable income (most jurisdictions)
‚Ä¢ Impermanent loss = capital loss
‚Ä¢ Token rewards = income at fair value
‚Ä¢ Keep detailed records`;

      suggestions = [
        "üéØ Start Conservative: USDC lending before complex strategies",
        "üìä IL Calculator: Always check before LP positions",
        "üîí Security: Use hardware wallet for large amounts",
        "‚ö° Gas Optimization: Use L2s (Arbitrum, Polygon) for smaller amounts",
        "üìà Compounding: Reinvest rewards weekly/monthly",
        "üé™ New Protocols: Only risk 1-2% portfolio on experimental",
        "üì± Automation: Yearn vaults good for hands-off approach",
        "üîÑ Rebalancing: Monitor and adjust based on market conditions",
        "üìö Education: Understand each protocol before depositing",
        "üí∞ Tax Planning: Track all transactions for reporting"
      ];
      risk_level = 'high';

    // Market Analysis and Macro
    } else if (question.includes('th·ªã tr∆∞·ªùng') || question.includes('market') || question.includes('macro') || question.includes('kinh t·∫ø')) {
      analysis = `üåç PH√ÇN T√çCH TH·ªä TR∆Ø·ªúNG & Vƒ® M√î:

üìä Current Market State (Q1 2024):
‚Ä¢ Total Crypto Market Cap: $1.7T (vs $3T peak)
‚Ä¢ Bitcoin Dominance: 52% (healthy level)
‚Ä¢ Daily Volume: $50-80B (normal range)
‚Ä¢ Fear & Greed Index: 60/100 (Neutral-Greedy)

üèõÔ∏è Macro Factors ·∫¢nh H∆∞·ªüng:

1Ô∏è‚É£ Federal Reserve Policy:
‚Ä¢ Current Rate: 5.25-5.50% (restrictive)
‚Ä¢ 2024 Outlook: 2-3 cuts expected
‚Ä¢ Impact: Rate cuts = risk-on = crypto bullish
‚Ä¢ Timeline: Cuts likely start Q2 2024

2Ô∏è‚É£ Inflation Trends:
‚Ä¢ US CPI: 3.2% (trending down from 9%)
‚Ä¢ Target: Fed wants 2%
‚Ä¢ Crypto Position: Digital gold hedge narrative
‚Ä¢ Reality: Short-term correlated with tech stocks

3Ô∏è‚É£ Dollar Strength:
‚Ä¢ DXY Index: 103 (strong but off highs)
‚Ä¢ Impact: Strong dollar = headwind for crypto
‚Ä¢ Outlook: May weaken with Fed cuts

üè¢ Institutional Adoption:

üìà Positive Developments:
‚Ä¢ BlackRock, Fidelity ETF success ($10B+ inflows)
‚Ä¢ MicroStrategy: 190K BTC treasury
‚Ä¢ El Salvador: Bitcoin legal tender
‚Ä¢ Corporate Payments: PayPal, Tesla acceptance

üìä Traditional Finance Integration:
‚Ä¢ JPMorgan: JPM Coin for settlements
‚Ä¢ SWIFT: Testing blockchain rails
‚Ä¢ CBDCs: 100+ countries exploring
‚Ä¢ Stablecoins: $150B market size

üîÆ Market Cycle Analysis:

üìà Bull Market Indicators:
‚Ä¢ ETF approvals and inflows
‚Ä¢ Halving effects (historically 12-18 months lag)
‚Ä¢ Developer activity increasing
‚Ä¢ Regulatory clarity improving

‚ö†Ô∏è Bear Market Risks:
‚Ä¢ Geopolitical tensions (war, trade)
‚Ä¢ Regulatory crackdowns
‚Ä¢ Major hack or protocol failure
‚Ä¢ Economic recession

üéØ 2024-2025 Scenarios:

üöÄ Bull Case (40% probability):
‚Ä¢ BTC: $80K-$120K by 2025
‚Ä¢ ETH: $8K-$12K
‚Ä¢ Total Market Cap: $4-6T
‚Ä¢ Triggers: ETF success, rate cuts, halving effect

üìä Base Case (45% probability):  
‚Ä¢ BTC: $60K-$80K
‚Ä¢ ETH: $5K-$8K
‚Ä¢ Total Market Cap: $3-4T
‚Ä¢ Scenario: Steady institutional adoption

üêª Bear Case (15% probability):
‚Ä¢ BTC: $25K-$40K
‚Ä¢ ETH: $1.5K-$3K
‚Ä¢ Triggers: Major recession, harsh regulation

üåè Regional Analysis:

üá∫üá∏ United States:
‚Ä¢ Regulation: Clearer rules post-ETF
‚Ä¢ Adoption: Institutional leading retail
‚Ä¢ Policy: Bipartisan crypto support growing

üá™üá∫ Europe:
‚Ä¢ MiCA Regulation: Clear framework
‚Ä¢ Adoption: Steady institutional growth
‚Ä¢ Innovation: Strong DeFi development

üá¶üá∏ Asia:
‚Ä¢ Japan: Crypto-friendly, strong adoption
‚Ä¢ Singapore: Financial hub for crypto
‚Ä¢ China: Hostile policy but private adoption
‚Ä¢ India: Developing regulatory framework`;

      suggestions = [
        "üìä Macro Calendar: Track Fed meetings, CPI, employment data",
        "üìà Cycle Timing: We're likely early-mid bull cycle phase",
        "üèõÔ∏è Institutions: Follow ETF flows as leading indicator",
        "üåç Global View: Don't focus only on US market",
        "‚ö° Correlation: Crypto still moves with tech stocks short-term",
        "üéØ Positioning: 60% established coins, 40% innovation bets",
        "üì± Tools: Use TradingView economic calendar",
        "üîÑ Rebalancing: Adjust allocation based on macro shifts",
        "üìö Education: Follow quality macro analysts (Lyn Alden, Raoul Pal)",
        "‚è∞ Patience: Macro themes play out over quarters/years"
      ];
      risk_level = 'medium';

    // Altcoin and Project Analysis
    } else if (question.includes('altcoin') || question.includes('alt') || question.includes('coin') || question.includes('token')) {
      analysis = `üöÄ ALTCOIN RESEARCH & INVESTMENT GUIDE:

üìä Current Altcoin Market:
‚Ä¢ Altcoin Market Cap: $800B (excluding BTC)
‚Ä¢ AltSeason Index: 65/100 (Moderate alt strength)
‚Ä¢ BTC Dominance: 52% (alt-friendly zone)
‚Ä¢ Top Performers YTD: AI, Gaming, RWA tokens

üîç Fundamental Analysis Framework:

1Ô∏è‚É£ Team & Development:
‚Ä¢ Team Background: Previous experience, reputation
‚Ä¢ Development Activity: GitHub commits, community engagement
‚Ä¢ Partnerships: Real utility partnerships vs marketing
‚Ä¢ Funding: VCs, treasury management, runway

2Ô∏è‚É£ Technology Assessment:
‚Ä¢ Innovation: Solving real problems?
‚Ä¢ Scalability: TPS, fees, user experience
‚Ä¢ Security: Audits, track record, decentralization
‚Ä¢ Competitive Advantage: What moat does it have?

3Ô∏è‚É£ Tokenomics Analysis:
‚Ä¢ Supply Schedule: Max supply, inflation rate
‚Ä¢ Distribution: Team %, community %, investors %
‚Ä¢ Utility: Governance, fees, staking, burning
‚Ä¢ Unlock Schedule: When do team/investor tokens unlock?

üèÜ Sector Analysis:

ü§ñ AI & Machine Learning:
‚Ä¢ Leaders: NEAR, FET, RNDR, TAO
‚Ä¢ Narrative: AI boom spillover into crypto
‚Ä¢ Risk: Most projects = speculation, little real AI
‚Ä¢ Opportunity: Infrastructure plays (compute, data)

‚ö° Layer 1 Blockchains:
‚Ä¢ Established: ETH, SOL, AVAX, NEAR, ATOM
‚Ä¢ Emerging: SUI, APT, SEI
‚Ä¢ Key Metrics: TVL, daily transactions, developer activity
‚Ä¢ Thesis: Multi-chain future, specialization

üéÆ Gaming & Metaverse:
‚Ä¢ Quality: IMMX, RONIN, GALA, SAND
‚Ä¢ Reality Check: Most games still not fun
‚Ä¢ Long-term: Billion+ gamers potential market
‚Ä¢ Risk: High competition, long development cycles

üí∞ Real World Assets (RWA):
‚Ä¢ Concept: Tokenize real estate, bonds, commodities
‚Ä¢ Players: ONDO, TRU, CFG, MPL
‚Ä¢ Opportunity: $300T traditional assets
‚Ä¢ Challenge: Regulation, custody, verification

üèõÔ∏è DeFi 2.0:
‚Ä¢ Evolution: Better UX, real yield, sustainability
‚Ä¢ Leaders: GMX, DYDX, AAVE, UNI
‚Ä¢ Innovation: Perpetuals, options, structured products
‚Ä¢ Risk: DeFi summer peaks may be behind us

üìä Selection Criteria:

‚úÖ Must-Haves:
‚Ä¢ Top 100 market cap (liquidity)
‚Ä¢ Active development (GitHub activity)
‚Ä¢ Clear use case (not just speculation)
‚Ä¢ Reasonable valuation (not 100x revenue)
‚Ä¢ Strong community (organic, not paid)

‚ùå Red Flags:
‚Ä¢ Anonymous teams
‚Ä¢ Promises without code
‚Ä¢ Meme-only value proposition
‚Ä¢ Insider-heavy token distribution
‚Ä¢ No real users despite high valuation

üéØ Investment Strategies:

üèõÔ∏è Conservative Portfolio:
‚Ä¢ 50% ETH (ecosystem leader)
‚Ä¢ 30% Top 5-10 alts (SOL, AVAX, MATIC)
‚Ä¢ 20% Sector leaders (AAVE, UNI, LINK)

‚ö° Growth Portfolio:
‚Ä¢ 30% ETH
‚Ä¢ 40% Top 20 alts
‚Ä¢ 30% Emerging projects (top 100)

üöÄ High Risk/Reward:
‚Ä¢ 20% ETH
‚Ä¢ 30% Established alts
‚Ä¢ 50% Small caps + new projects

üìà Research Tools:

üìä Analytics:
‚Ä¢ CoinGecko: Market data, metrics
‚Ä¢ Messari: Deep fundamental analysis
‚Ä¢ DeFiLlama: TVL and protocol data
‚Ä¢ Token Terminal: Revenue and usage

üì± Social Intelligence:
‚Ä¢ Twitter: Developer activity, community sentiment
‚Ä¢ Discord/Telegram: Active communities
‚Ä¢ Reddit: Genuine discussions vs shilling
‚Ä¢ GitHub: Code commits, contributor activity

üí° Due Diligence Checklist:
‚Ä¢ Read whitepaper + tokenomics
‚Ä¢ Check team backgrounds (LinkedIn)
‚Ä¢ Analyze token distribution and unlocks
‚Ä¢ Test the product if available
‚Ä¢ Join community, ask hard questions
‚Ä¢ Compare to competitors
‚Ä¢ Assess total addressable market`;

      suggestions = [
        "üîç Research: Spend 10+ hours researching before investing",
        "üìä Diversification: Max 5% portfolio in any single altcoin",
        "‚è∞ Unlock Calendar: Track team/investor token releases",
        "üë• Community: Join official Discord/Telegram for updates",
        "üìà Dollar Cost Average: Spread entries over time",
        "üéØ Sector Allocation: 2-3 sectors max to stay focused",
        "üì± Alerts: Set price alerts, don't check charts constantly",
        "üí∞ Profit Taking: Sell 25-50% at 3-5x gains",
        "üîí Security: Use hardware wallet for large holdings",
        "üìö Continuous Learning: Follow project updates, pivots"
      ];
      risk_level = 'high';

    // Trading Strategies and Technical Analysis
    } else if (question.includes('strategy') || question.includes('chi·∫øn l∆∞·ª£c') || question.includes('technical') || question.includes('ph√¢n t√≠ch')) {
      analysis = `üìà TRADING STRATEGIES & TECHNICAL ANALYSIS:

‚ö° Popular Trading Strategies:

1Ô∏è‚É£ Dollar Cost Averaging (DCA):
‚Ä¢ Method: Fixed $ amount, regular intervals
‚Ä¢ Best For: Long-term investors, emotional traders
‚Ä¢ Pros: Reduces timing risk, simple to execute
‚Ä¢ Cons: May underperform lump sum in bull market
‚Ä¢ Crypto DCA: Weekly better than monthly (higher volatility)

2Ô∏è‚É£ Swing Trading:
‚Ä¢ Timeframe: Days to weeks
‚Ä¢ Method: Buy support, sell resistance
‚Ä¢ Tools: RSI, MACD, support/resistance
‚Ä¢ Risk: 2-4% stop loss
‚Ä¢ Target: 10-30% moves

3Ô∏è‚É£ Breakout Trading:
‚Ä¢ Method: Buy when price breaks key resistance
‚Ä¢ Confirmation: Volume spike + follow-through
‚Ä¢ Stop Loss: Below breakout level
‚Ä¢ Target: Measured move or next resistance
‚Ä¢ Success Rate: 40-50% but asymmetric reward

4Ô∏è‚É£ Mean Reversion:
‚Ä¢ Method: Buy oversold, sell overbought
‚Ä¢ Tools: RSI <30 (buy), RSI >70 (sell)
‚Ä¢ Works Best: Range-bound markets
‚Ä¢ Risk: Catching falling knives
‚Ä¢ Crypto Application: Works on established coins

üìä Technical Analysis for Crypto:

üïê Timeframe Selection:
‚Ä¢ Scalping: 1m-15m (not recommended for beginners)
‚Ä¢ Day Trading: 1h-4h
‚Ä¢ Swing Trading: 4h-1D
‚Ä¢ Position Trading: 1D-1W
‚Ä¢ Investing: 1W-1M

üìà Key Indicators:

üî¢ Trend Following:
‚Ä¢ Moving Averages: 20, 50, 200 EMA
‚Ä¢ MACD: 12,26,9 settings
‚Ä¢ ADX: Trend strength >25
‚Ä¢ Parabolic SAR: Dynamic support/resistance

üìä Oscillators:
‚Ä¢ RSI: 14-period, overbought >70, oversold <30
‚Ä¢ Stochastic: %K and %D lines
‚Ä¢ Williams %R: -20 to -80 range
‚Ä¢ CCI: Commodity Channel Index

üìê Support/Resistance:
‚Ä¢ Horizontal: Previous highs/lows
‚Ä¢ Fibonacci: 23.6%, 38.2%, 50%, 61.8%
‚Ä¢ Trendlines: Connect swing highs/lows
‚Ä¢ Volume Profile: High volume areas

üåä Volume Analysis:
‚Ä¢ Volume Confirmation: Price moves need volume
‚Ä¢ Volume Divergence: Price up, volume down = weak
‚Ä¢ Accumulation/Distribution: Smart money flow
‚Ä¢ Volume Profile: Support/resistance levels

‚ö†Ô∏è Crypto-Specific Considerations:

üîÑ Market Structure:
‚Ä¢ 24/7 Trading: No gaps like traditional markets
‚Ä¢ Weekend Volume: Often lower, more manipulation
‚Ä¢ Asian vs US Sessions: Different volume patterns
‚Ä¢ Exchange Differences: Arbitrage opportunities

üêã Whale Impact:
‚Ä¢ Large Holders: Can move markets significantly
‚Ä¢ Whale Alerts: Track large transactions
‚Ä¢ Order Book: Watch for large walls
‚Ä¢ Slippage: Consider impact on large trades

üìä On-Chain Analysis:
‚Ä¢ Active Addresses: Network usage indicator
‚Ä¢ Transaction Volume: Real economic activity
‚Ä¢ Exchange Flows: Selling pressure indicator
‚Ä¢ Long-term Holder Behavior: Conviction metric

üéØ Risk Management for Trading:

üí∞ Position Sizing:
‚Ä¢ 1-2% account risk per trade
‚Ä¢ Max 5 open positions simultaneously
‚Ä¢ Reduce size during losing streaks
‚Ä¢ Increase size during winning streaks

üìä Risk/Reward:
‚Ä¢ Minimum 1:2 risk/reward ratio
‚Ä¢ Better traders: 1:3 or higher
‚Ä¢ Calculate before entering trade
‚Ä¢ Stick to predetermined levels

‚è∞ Time Management:
‚Ä¢ Set specific trading hours
‚Ä¢ Avoid emotional trading (FOMO times)
‚Ä¢ Take breaks between trades
‚Ä¢ Review performance weekly

üß† Psychology Integration:
‚Ä¢ Plan trades, trade plans
‚Ä¢ Use checklists for consistency
‚Ä¢ Journal emotions and outcomes
‚Ä¢ Accept losses as cost of business`;

      suggestions = [
        "üìä Backtesting: Test strategies on historical data first",
        "üì± Paper Trading: Practice with fake money before real",
        "üéØ Specialization: Master 1-2 strategies vs jack of all trades",
        "‚è∞ Market Hours: Trade during high volume periods",
        "üìà Trend Following: Easier than picking tops/bottoms",
        "üî¢ Statistics: Track win rate, avg win/loss, profit factor",
        "üßò Mindset: Focus on process, not individual trades",
        "üìö Education: Study successful traders (Livermore, Weinstein)",
        "üõ†Ô∏è Tools: TradingView, Coinigy for analysis",
        "üîÑ Adaptation: Adjust strategies based on market conditions"
      ];
      risk_level = 'high';

    // Default comprehensive response for general questions
    } else {
      analysis = `üíº COMPREHENSIVE CRYPTO MARKET OVERVIEW:

üåç Global Crypto Landscape 2024:
Th·ªã tr∆∞·ªùng crypto ƒëang ·ªü giai ƒëo·∫°n th√∫ v·ªã v·ªõi nhi·ªÅu catalysts t√≠ch c·ª±c.

üìä Market Fundamentals:
‚Ä¢ Total Market Cap: $1.7T (recovery from $800B bottom)
‚Ä¢ Bitcoin Dominance: 52% (healthy for altcoin growth)
‚Ä¢ Daily Volume: $50-80B (normal trading activity)  
‚Ä¢ Active Wallets: 100M+ globally
‚Ä¢ Institutional Adoption: Accelerating rapidly

üèõÔ∏è Regulatory Environment:
‚Ä¢ United States: ETF approvals breakthrough
‚Ä¢ Europe: MiCA framework provides clarity
‚Ä¢ Asia: Mixed but improving (Japan positive, Singapore hub)
‚Ä¢ Global Trend: Regulation vs prohibition

üöÄ Technology Developments:
‚Ä¢ Layer 2 Scaling: Ethereum fees down 90%
‚Ä¢ Interoperability: Cross-chain bridges improving
‚Ä¢ Real-World Assets: Traditional finance tokenizing
‚Ä¢ AI Integration: Crypto + AI convergence
‚Ä¢ Central Bank Digital Currencies: 100+ countries testing

üí∞ Investment Themes 2024:
‚Ä¢ Bitcoin: Digital gold, institutional allocation
‚Ä¢ Ethereum: DeFi and smart contract platform leader
‚Ä¢ Layer 1s: Multi-chain future, specialization
‚Ä¢ DeFi 2.0: Sustainable yield, better UX
‚Ä¢ Gaming/NFTs: Utility beyond speculation
‚Ä¢ AI Tokens: Infrastructure and compute

‚ö†Ô∏è Risk Factors:
‚Ä¢ Regulatory uncertainty in major markets
‚Ä¢ Economic recession impacting risk assets
‚Ä¢ Technical risks (hacks, protocol failures)
‚Ä¢ Market manipulation and volatility
‚Ä¢ Environmental concerns (proof-of-work)

üéØ Investment Framework:

üèõÔ∏è Core Holdings (60-70%):
‚Ä¢ Bitcoin: Store of value, institutional adoption
‚Ä¢ Ethereum: Smart contract platform leader
‚Ä¢ Major Altcoins: SOL, AVAX, MATIC, LINK

‚ö° Growth Plays (20-30%):
‚Ä¢ Sector Leaders: AAVE (DeFi), UNI (DEX), SAND (Gaming)
‚Ä¢ Layer 2s: ARB, OP, MATIC
‚Ä¢ New Narratives: AI, RWA, Gaming

üöÄ Speculation (5-10%):
‚Ä¢ Small Cap Gems: High risk/reward
‚Ä¢ New Launches: Early opportunities
‚Ä¢ Meme Coins: Pure speculation

üìà Success Principles:
‚Ä¢ Education: Understand what you invest in
‚Ä¢ Patience: Crypto rewards long-term thinking
‚Ä¢ Risk Management: Never invest more than you can lose
‚Ä¢ Diversification: Don't put all eggs in one basket
‚Ä¢ Emotional Control: Fear and greed destroy wealth
‚Ä¢ Continuous Learning: Space evolves rapidly

üõ†Ô∏è Essential Tools:
‚Ä¢ Portfolio Tracking: CoinTracker, Koinly
‚Ä¢ News: CoinDesk, The Block, Decrypt
‚Ä¢ Analysis: Messari, Glassnode, CryptoQuant
‚Ä¢ Trading: Binance, Coinbase, Kraken
‚Ä¢ Security: Hardware wallets (Ledger, Trezor)`;

      suggestions = [
        "üìö Education First: Understand blockchain basics before investing",
        "üí∞ Start Small: Invest only what you can afford to lose completely",
        "üéØ Goal Setting: Define investment timeline and objectives",
        "üìä Portfolio Balance: 60% established, 30% growth, 10% speculation",
        "üîí Security: Use hardware wallets for significant holdings",
        "üì± Stay Informed: Follow quality news sources, avoid FOMO",
        "‚è∞ Long-term View: Most successful crypto investors are HODLers",
        "ü§ù Community: Join educational groups, avoid pump & dump channels",
        "üìà DCA Strategy: Regular investments reduce timing risk",
        "üßò Emotional Control: Develop trading discipline and patience",
        "üéì Continuous Learning: Technology evolves rapidly",
        "üîÑ Rebalancing: Review and adjust portfolio quarterly"
      ];
      risk_level = 'medium';
    }

    return {
      analysis,
      suggestions,
      risk_level,
      confidence: 0.85
    };
  }
};

export const analyzePortfolio = async (portfolio: any[]) => {
  return getAIInsights({
    type: 'portfolio_analysis',
    data: { portfolio }
  });
};

export const getPrediction = async (symbol: string) => {
  return getAIInsights({
    type: 'market_prediction',
    data: { symbol }
  });
};

export const getTradingSuggestion = async (marketData: any) => {
  return getAIInsights({
    type: 'trading_suggestion',
    data: { marketData }
  });
};

// Enhanced chat-specific function
export const getChatResponse = async (question: string) => {
  return getAIInsights({
    type: 'chat_question',
    data: { question }
  });
};
